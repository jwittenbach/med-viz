<!DOCTYPE html>
<html>
  	<head>
    	<title>reading file</title>
    	<script type="text/javascript">
    		
            // globals
            var ctx;
            var shapes;

            var nMuscles = 6;
            var nShapes = nMuscles+1;

            var nColors = 3;
            var colorMap = ['rgb(255,255,255)', 'rgb(0,0,255)', 'rgb(255,0,0)', 'rgb(255, 255, 0'];

            var colors = new Array(nShapes);
            for (var i=0; i<colors.length; i++) {
                colors[i] = 0;
            }

            var init = function() {
                // set up the canvas context
                ctx = document.getElementById("canvas").getContext("2d");

                // generate buttons
                makeButtons();

                // read json file with art information
                loadAndDraw();
                
                // testing
                document.getElementById("test-text").innerHTML = colors;
            }

            var updateColors = function(that) {
                muscle = parseInt(that.id.substring(6, that.id.length));
                colors[muscle+1] = that.value;
                drawShapes();
                
                // testing
                document.getElementById("test-text").innerHTML = colors;
            }

            var makeButtons = function() {
                var buttonString = '';
                buttonString += '<ul>\n';
                for (var i=0; i<nMuscles; i++) {
                    buttonString += '<li>\n';
                    buttonString += '<select id=muscle' + i + ' onchange="updateColors(this)">\n';
                    buttonString += '<option value="0"></option>\n';
                    for (var j=0; j<nColors; j++) {
                        option = j+1;
                        buttonString += '<option value="' + option + '">color' + option + '</option>\n';
                    }
                    buttonString += '</li>\n';
                    buttonString += '</select>\n';
                }
                buttonString += '</ul>\n';

                document.getElementById('buttons').innerHTML = buttonString;
            }

            var loadAndDraw = function() {
                var xmlhttp = new XMLHttpRequest();

                xmlhttp.onreadystatechange = function() {
                    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                        shapes = JSON.parse(xmlhttp.responseText);
                        drawShapes();
                    }
                }

                xmlhttp.open("GET", 'shapes.json', true);
                xmlhttp.send();
            }

            var drawShapes = function() {

                // clear the canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // draw all shapes
                for (var i=0; i<shapes.length; i++) {
                    drawShape(shapes[i], colorMap[colors[i]]);
                }
            }

            var drawShape = function(shape, color) {

				// line/fill properties
				ctx.fillStyle=color;
				ctx.lineStyle="rgb(0,0,0)";
				ctx.lineWidth=2;

    			// draw line elements
    			dx = -375;
                dy = 575;
                ctx.beginPath();
                var first = true;
    			for (var i=0; i<shape.length; i++) {
    				l = shape[i];
    				if (l.line) {
    					v = l.line;
    					if (first) {
                            ctx.moveTo(dx+v[0], dy+v[1]);
                            first = false;
                        }
    					ctx.lineTo(dx+v[2], dy+v[3]);
    				}
    				else if (l.bezier) {
    					v = l.bezier;
    					if (first) {
                            ctx.moveTo(dx+v[0], dy+v[1]);
                            first = false;
                        }
    					ctx.bezierCurveTo(dx+v[2], dy+v[3], dx+v[4], dy+v[5], dx+v[6], dy+v[7]);
    				}
    			}
                ctx.closePath();
    			ctx.stroke();
    			ctx.fill();
    		}

		</script>
	</head>

	<body onload='init()'>
        <div class="container">
            <div id="buttons" style="float:left;">
               <!-- buttons generated by makeButtons() on load -->
            </div>
            <div style="float:center;">
                <canvas id="canvas" width="225" height="600"></canvas>
            </div>
        </div>
        <div id="test-text">
            example text
        </div>
	</body>
</html>
